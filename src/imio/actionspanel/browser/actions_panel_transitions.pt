<tal:defines define="objectUID python: context.UID();
                     useIcons view/useIcons;">
<td tal:repeat="transition view/getTransitions"
    class="noPadding" align="left">
  <tal:transition condition="transition/may_trigger">

    <a href="@@triggertransition"
       class="#"
       tal:attributes="href python: context.absolute_url()
                                    + '/'
                                    + confirmation_view
                                    + '?objectUid='
                                    + objectUID
                                    + '&transition='
                                    + transition['id']
                                    + (not confirm and '&form.submitted=boolean:True' or '');
                       class python: confirm and 'link-overlay-actionspanel transition-overlay' or ''"
       tal:define="transitionId python: transition['id'];
                   imageName python:  transitionId + '.png';
                   confirm python: transition['confirm'];
                   confirmation_view python: transition['confirmation_view'];
                   dummy view/saveHasActions;">
      <tal:comment replace="nothing">Icon</tal:comment>
      <img tal:condition="python: useIcons and hasattr(view.portal, imageName)"
           tal:attributes="src string: ${view/portal_url}/$imageName;
                           title transition/title;"/>
      <tal:comment replace="nothing">Display a input button if useIcons is False.  Moreover, a <form> is necessary
                                     around an <input /> for IE...</tal:comment>
      <form action="#"
            tal:condition="python: not(useIcons and hasattr(view.portal, imageName))"
            tal:attributes="action python: context.absolute_url() + '/@@triggertransition'">
      <input type="hidden" name="objectUid" tal:attributes="value objectUID;"/>
      <input type="hidden" name="transition" tal:attributes="value python: transition['id'];"/>
      <input type="hidden" name="form.submitted" tal:attributes="value python: (not confirm and '&form.submitted=boolean:True' or '');"/>
      <input type="submit"
             tal:attributes="class string:apButton apButtonWF apButtonWF_$transitionId;
                             value python: view.appendTypeNameToTransitionLabel and (context.utranslate(transition['title'], domain='plone') + ' ' + context.utranslate(msgid=context.portal_type, domain='plone')) or transition['title'];
                             size python: int(len(transition['title'])/1.2);" />
      </form>
    </a>

  </tal:transition>

  <tal:comment replace="nothing">The user can't trigger this transition: we tell him why.</tal:comment>
  <tal:notTriggerableTransition condition="not: transition/may_trigger">
    <tal:defines define="transitionId python: transition['id'];
                         imageName python:  transitionId + '.png';">
        <input type="button" disabled
               tal:condition="python: not(useIcons and hasattr(view.portal, imageName))"
               class="apButton notTriggerableTransitionButton"
               tal:attributes="value transition/title;
                               title transition/reason"
               i18n:attributes="value" />
        <img class="notTriggerableTransitionImage"
             tal:condition="python: useIcons and hasattr(view.portal, imageName)"
             tal:attributes="src string: ${view/portal_url}/$imageName;
                             title python: '%s -> %s' % (transition['title'], transition['reason']);"/>
    </tal:defines>
  </tal:notTriggerableTransition>
</td>
</tal:defines>
